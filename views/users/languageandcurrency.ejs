<%- layout("/layouts/boilerplate.ejs")  %>

<link rel="stylesheet" href="/css/editprofile.css">

<body>
    <div class="personal-info-pannel">
        <h6><a href="/account">Account</a>  &nbsp; &nbsp; <i class="fa-solid fa-angle-right"></i>  &nbsp;&nbsp; <b>Language & currency</b></h6>
        <h2>Language & currency</h2>
        <div class="info-detail-pannel">
            <div class="details-and-form">
                <div class="info">
                    <div>
                    <h6 class="h6-lable">Preferred language</h6>
                    <h6 class="h6-data"><%= currUser?.countryInfo?.language?.name || "Not provided" %></h6>
                    </div>
                    <div class="edit-btns">
                        <span class="edit">Edit</span>
                        <span class="cancel hide">Cancel</span>
                    </div>
                                
                </div>
                <div class="edit-form hide">
                    <form action="/account/personal-info/<%= currUser._id %>?_method=patch" method="post" class="needs-validation animation-submit" novalidate>                      
                        <div class="lable-and-input">
                            <label for="language" class="form-label mt-2">This updates what you read on Airbnb, and how we communicate with you.</label>                      
                            <select name="countryInfo[language][name]" id="language" class="form-select mt-3" required>
                                <option selected disabled value="">Select language</option>                 
                            </select>  
                            <div class="invalid-feedback">Please selecet a language</div>  
                        </div>          
                        <button class="btn btn-dark mt-3 submitBtn">
                            <span class="submitBtn-text">Save</span>
                            <div class="spinner" style="display: none;">
                                <span class="dot dot-1"></span>
                                <span class="dot dot-2"></span>
                                <span class="dot dot-3"></span>
                            </div>
                        </button>
                    </form>
                </div> 
            </div> 
           <div class="details-and-form">
            <div class="info">
                <div>
                <h6 class="h6-lable">Preferred currency</h6>
                <h6 class="h6-data"><%= currUser?.countryInfo?.currency %></h6>
                </div>
                <div class="edit-btns">
                    <span class="edit">Edit</span>
                    <span class="cancel hide">Cancel</span>
                </div>
                
            </div>
            <div class="edit-form hide">
                <form action="/account/personal-info/<%= currUser._id %>?_method=patch" method="post" class="needs-validation animation-submit" novalidate>                        
                    <div class="lable-and-input mt-3">                    
                        <select name="countryInfo[currency]" id="currency" class="form-select mt-3" required>
                            <option selected disabled value="">Select currency</option>
                        </select>  
                        <div class="invalid-feedback">Please selecet a currency</div>  
                    </div>  
                    <button class="btn btn-dark mt-3 submitBtn">
                        <span class="submitBtn-text">Save</span>
                        <div class="spinner" style="display: none;">
                            <span class="dot dot-1"></span>
                            <span class="dot dot-2"></span>
                            <span class="dot dot-3"></span>
                        </div>
                    </button>
                </form>
            </div> 
           </div>
          <div class="details-and-form">
            <div class="info">
                <div>
                 <h6 class="h6-lable">Time zone</h6>
                 <h6 class="h6-data"><%= currUser?.countryInfo?.timezone %></h6>
                </div>
                <div class="edit-btns">
                 <span class="edit">Edit</span>
                 <span class="cancel hide">Cancel</span>
                </div>          
             </div>  
             <div class="edit-form hide">
                <!-- <div class="h6-data mb-3">Use a permanent address</div>         -->
                <form action="/account/personal-info/<%= currUser._id %>?_method=patch" method="post" novalidate class="needs-validation animation-submit">                        
                     <div class="input-box mt-3">   
                        <div class="lable-and-input">
                            <!-- <label for="timezone" class="form-label">This updates the timezone on airbnb.</label>                       -->
                            <select name="countryInfo[timezone]" id="timezone" class="form-select" required>
                                <option selected disabled value="">Select timezone</option>   
                            </select>  
                            <div class="invalid-feedback">Please selecet a timezone</div>  
                        </div>           
                     </div>
                     <button class="btn btn-dark mt-3 submitBtn">
                        <span class="submitBtn-text">Save</span>
                        <div class="spinner" style="display: none;">
                            <span class="dot dot-1"></span>
                            <span class="dot dot-2"></span>
                            <span class="dot dot-3"></span>
                        </div>
                    </button>
                 </form>
             </div>  
          </div>        
        </div>
    </div>

    <script>

        function populateCurrencyOptions(selectElement) {
            const currencies = [
                { key: "INR", value: "Indian Rupee" },
                { key: "AUD", value: "Australian Dollar" },
                { key: "BRL", value: "Brazilian Real" },
                { key: "BGN", value: "Bulgarian Lev" },
                { key: "CAD", value: "Canadian Dollar" },
                { key: "CLP", value: "Chilean Peso" },
                { key: "CNY", value: "Chinese Yuan" },
                { key: "COP", value: "Colombian Peso" },
                { key: "CRC", value: "Costa Rican ColÃ³n" },
                { key: "CZK", value: "Czech Koruna" },
                { key: "AED", value: "United Arab Emirates Dirham" },
                { key: "EUR", value: "Euro" },
                { key: "EGP", value: "Egyptian Pound" },
                { key: "HKD", value: "Hong Kong Dollar" },
                { key: "HUF", value: "Hungarian Forint" },
                { key: "IDR", value: "Indonesian Rupiah" },
                { key: "JPY", value: "Japanese Yen" },
                { key: "MXN", value: "Mexican Peso" },
                { key: "MAD", value: "Moroccan Dirham" },
                { key: "TWD", value: "New Taiwan Dollar" },
                { key: "NZD", value: "New Zealand Dollar" },
                { key: "NOK", value: "Norwegian Krone" },
                { key: "PEN", value: "Peruvian Sol" },
                { key: "PHP", value: "Philippine Peso" },
                { key: "GBP", value: "British Pound" },
                { key: "QAR", value: "Qatari Riyal" },
                { key: "RON", value: "Romanian Leu" },
                { key: "SAR", value: "Saudi Riyal" },
                { key: "SGD", value: "Singapore Dollar" },
                { key: "ZAR", value: "South African Rand" },
                { key: "KRW", value: "South Korean Won" },
                { key: "SEK", value: "Swedish Krona" },
                { key: "CHF", value: "Swiss Franc" },
                { key: "THB", value: "Thai Baht" },
                { key: "TRY", value: "Turkish Lira" },
                { key: "UGX", value: "Ugandan Shilling" },
                { key: "UAH", value: "Ukrainian Hryvnia" },
                { key: "USD", value: "United States Dollar" },
                { key: "UYU", value: "Uruguayan Peso" },
                { key: "VND", value: "Vietnamese Dong" }
            ];

            currencies.forEach(currency => {
                const option = document.createElement('option');
                option.value = currency.key;
                option.textContent = currency.value;
                selectElement.appendChild(option);
            });
        };

        let currencySelect = document.querySelector("#currency");
        populateCurrencyOptions(currencySelect);

        function populateLanguageOptions(selectElement) {
            const languages = [
                "English(Australia)",
                "English(Canada)",
                "Espanol(Mexico)",
                "English(UK)",
                "Espanol(Argentina)",    
                "English",
                "Spanish",
                "French",
                "German",
                "Hindi",
                "Arabic",
                "Chinese",
                "Japanese",
                "Russian",
                "Portuguese",
                "Italian",
                "Korean",
                "Dutch",
                "Turkish",
                "Bengali",                            
            ];

            languages.forEach(language => {
                const option = document.createElement('option');
                option.value = language;
                option.textContent = language;
                selectElement.appendChild(option);
            });
            };
            
        let languageSelect = document.querySelector("#language");
        populateLanguageOptions(languageSelect);
        
        const timezones = {
            "Asia/Kolkata": ["Kolkata", "Delhi", "Mumbai"],
            "America/New_York": ["New York"],
            "Europe/London": ["London"],
            "Europe/Paris": ["Paris"],
            "Europe/Amsterdam": ["Amsterdam"],
            "Europe/Berlin": ["Berlin"],
            "Europe/Rome": ["Rome"],
            "Asia/Tokyo": ["Tokyo"],
            "Asia/Dubai": ["Dubai"],
            "Australia/Sydney": ["Sydney"],
            "America/Los_Angeles": ["Los Angeles"],
            "America/Chicago": ["Chicago"],
            "Asia/Singapore": ["Singapore"],
            "Africa/Johannesburg": ["Johannesburg"],
            "Europe/Berlin": ["Berlin"],
            "America/Toronto": ["Toronto"],
            "America/Sao_Paulo": ["Sao Paulo"],
            "Asia/Seoul": ["Seoul"],
            "Asia/Shanghai": ["Shanghai"],
            "Pacific/Auckland": ["Auckland"],
            "Europe/Moscow": ["Moscow"],
            "Asia/Tehran": ["Tehran"]
        };

        function getGmtOffset(timezone) {
            const now = new Date();
            const tzString = now.toLocaleTimeString('en-US', {
                timeZone: timezone,
                timeZoneName: 'short'
            });
            const match = tzString.match(/\bGMT([+-]\d{1,2})(?::(\d{2}))?\b/);
            if (match) {
                const hours = match[1].padStart(3, '0');
                const minutes = match[2] || '00';
                return `GMT${hours}:${minutes}`;
            }
            return 'GMT+00:00';
        }

        function populateTimeZoneSelect(selectElement) {
            Object.entries(timezones).forEach(([tzId, cities]) => {
                const option = document.createElement('option');
                const gmtOffset = getGmtOffset(tzId);
                option.value = tzId;
                option.textContent = `${gmtOffset} ${tzId} (${cities.join(", ")})`;
                selectElement.appendChild(option);
            });
        }

        const select = document.getElementById('timezone');
        populateTimeZoneSelect(select);

        // let editBtns = document.querySelectorAll(".edit-btns");     

        // for (let editBtn of editBtns) {
        //     editBtn.addEventListener("click", (e)=>{                        
        //     if (e.target.innerText === "Edit") {                           
        //         let edit = editBtn.querySelector(".edit");  
        //         let cancel = editBtn.querySelector(".cancel");             
        //         let editForm = e.target.parentElement.parentElement.nextElementSibling;
        //         let h6Data = e.target.parentElement.previousElementSibling.children[1];
        //         let h6Lable = e.target.parentElement.previousElementSibling.children[0];
        //         edit.classList.add("hide");                
        //         cancel.classList.remove("hide");
        //         editForm.classList.remove("hide");
        //         h6Data.classList.add("hide");    
        //         let disabledEdits = document.querySelectorAll(".edit");
        //         for (let disabledEdit of disabledEdits) {
        //             disabledEdit.classList.add("pointer-none");
        //         }       
        //         let labels= document.querySelectorAll(".info .h6-lable");
        //         for (let label of labels) {
        //             label.classList.add("pointer-none");
        //         }            
        //         h6Lable.classList.remove("pointer-none");
        //     }            
        //     });           
        // }
       
        // for (let editBtn of editBtns) { 
        //     editBtn.addEventListener("click", (e)=>{            
        //     if (e.target.innerText === "Cancel"){                
        //         let edit = editBtn.querySelector(".edit"); 
        //         let cancel = editBtn.querySelector(".cancel");
        //         let editForm = e.target.parentElement.parentElement.nextElementSibling;
        //         let h6Data = e.target.parentElement.previousElementSibling.children[1];               
        //         cancel.classList.add("hide");
        //         edit.classList.remove("hide");
                
        //         let select = editForm.querySelector("select");                      
                               
        //         if(select){                    
        //             select.value = "";           
        //             select.addEventListener("change",()=>{
        //                 if (!select.value) {                  
        //                     select.value = select[0].innerText;
        //                     select[0].selected = true;
        //                 }
        //             })
        //         }
        //         editForm.classList.add("hide");
        //         h6Data.classList.remove("hide");              
        //         let disabledEdits = document.querySelectorAll(".edit");
        //         for (let disabledEdit of disabledEdits) {
        //             disabledEdit.classList.remove("pointer-none");
        //         }               
        //         let labels= document.querySelectorAll(".info .h6-lable");
        //         for (let label of labels) {
        //             label.classList.remove("pointer-none");
        //         }    
        //     }         
        // });
        // }
   
   </script>
   <script src="/js/editprofile.js"></script>
</body>